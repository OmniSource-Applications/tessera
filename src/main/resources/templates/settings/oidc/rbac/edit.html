<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<body>

<th:block th:fragment="content">

    <div class="flex items-start justify-between gap-4 mb-6">
        <div>
            <h2 class="text-lg font-semibold text-foreground" th:text="${file}">policy.json</h2>
            <p class="mt-1 text-sm text-muted">Edit the RBAC JSON policy. Invalid JSON will not save.</p>
        </div>
        <div class="flex flex-wrap gap-2">
            <a th:href="@{/settings/oidc/rbac}"
               class="inline-flex items-center gap-2 rounded-lg bg-background border border-border text-foreground px-3 py-2 text-sm font-semibold hover:bg-background/60">
                <svg class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 19.5L8.25 12l7.5-7.5"/>
                </svg>
                Back to list
            </a>
        </div>
    </div>

    <div th:if="${error != null}" class="mb-4 rounded-lg border border-danger/30 bg-danger/10 p-4 text-sm text-danger" th:text="${error}"></div>
    <div th:if="${info != null}" class="mb-4 rounded-lg border border-border bg-background p-4 text-sm text-muted" th:text="${info}"></div>

    <section class="bg-surface border border-border rounded-xl overflow-hidden">
        <form th:action="@{/settings/oidc/rbac/{file}(file=${file})}" method="post">

            <div class="p-4 border-b border-border flex items-center justify-between gap-4">
                <div class="text-xs text-muted">
                    Permission required: <span class="font-mono">TESSERA_RBAC_EDIT</span>
                </div>
                <button type="submit"
                        sec:authorize="hasAuthority('TESSERA_RBAC_EDIT')"
                        class="h-9 rounded-lg bg-primary text-primary-foreground px-4 text-sm font-semibold hover:opacity-90">
                    Save
                </button>
                <span sec:authorize="!hasAuthority('TESSERA_RBAC_EDIT')"
                      class="text-xs text-muted">Read-only</span>
            </div>

            <div class="p-4">
                <textarea name="json"
                          rows="28"
                          spellcheck="false"
                          sec:authorize="hasAuthority('TESSERA_RBAC_EDIT')"
                          class="w-full font-mono text-xs rounded-lg bg-background border border-border px-3 py-3 text-foreground placeholder:text-muted focus:outline-none focus:ring-2 focus:ring-primary/40"
                          th:text="${json}"></textarea>

                <textarea name="json"
                          rows="28"
                          spellcheck="false"
                          readonly
                          sec:authorize="!hasAuthority('TESSERA_RBAC_EDIT')"
                          class="w-full font-mono text-xs rounded-lg bg-background border border-border px-3 py-3 text-foreground placeholder:text-muted"
                          th:text="${json}"></textarea>

                <p class="mt-3 text-xs text-muted">
                    Tip: subject keys should be stable (e.g., <span class="font-mono">oidc:sub:&lt;uuid&gt;</span>).
                </p>
            </div>
        </form>
    </section>

</th:block>

</body>
</html>
