<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<body>

<th:block th:fragment="content">

    <div class="flex items-start justify-between gap-4 mb-6">
        <div>
            <h2 class="text-lg font-semibold text-foreground">Policy Files</h2>
            <p class="mt-1 text-sm text-muted">Stored under <span class="font-mono text-xs">data_dir/etc/auth/rbac</span>.</p>
        </div>

        <div class="flex flex-wrap gap-2">
            <a th:href="@{/settings/oidc}"
               class="inline-flex items-center gap-2 rounded-lg bg-background border border-border text-foreground px-3 py-2 text-sm font-semibold hover:bg-background/60">
                <svg class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 19.5L8.25 12l7.5-7.5"/>
                </svg>
                OIDC
            </a>
        </div>
    </div>

    <div th:if="${error != null}" class="mb-4 rounded-lg border border-danger/30 bg-danger/10 p-4 text-sm text-danger" th:text="${error}"></div>
    <div th:if="${success != null}" class="mb-4 rounded-lg border border-primary/30 bg-primary/10 p-4 text-sm text-primary" th:text="${success}"></div>

    <section class="bg-surface border border-border rounded-xl overflow-hidden">
        <div class="p-4 border-b border-border flex items-center justify-between gap-4">
            <div class="text-sm text-muted">
                <span th:text="${#lists.size(policies)}">0</span> file(s)
            </div>

            <form th:action="@{/settings/oidc/rbac/new}" method="post" class="flex items-center gap-2"
                  sec:authorize="hasAuthority('TESSERA_RBAC_EDIT')">
                <input name="name" placeholder="new-policy.json"
                       class="h-9 w-56 rounded-lg bg-background border border-border px-3 text-sm text-foreground placeholder:text-muted focus:outline-none focus:ring-2 focus:ring-primary/40"/>
                <button type="submit"
                        class="h-9 rounded-lg bg-primary text-primary-foreground px-3 text-sm font-semibold hover:opacity-90">
                    New
                </button>
            </form>
        </div>

        <div class="overflow-x-auto">
            <table class="min-w-full text-sm">
                <thead class="bg-background/50">
                <tr class="text-left text-xs font-semibold uppercase tracking-wider text-muted">
                    <th class="px-4 py-3">File</th>
                    <th class="px-4 py-3">Modified</th>
                    <th class="px-4 py-3">Size</th>
                    <th class="px-4 py-3"></th>
                </tr>
                </thead>
                <tbody class="divide-y divide-border">
                <tr th:if="${#lists.isEmpty(policies)}">
                    <td colspan="4" class="px-4 py-6 text-muted">
                        No policy files found. Create one to get started.
                    </td>
                </tr>

                <tr th:each="p : ${policies}" class="hover:bg-background/40">
                    <td class="px-4 py-3 font-mono text-xs text-foreground" th:text="${p.name}">policy.json</td>
                    <td class="px-4 py-3 text-muted" th:text="${p.modified} ?: '—'">—</td>
                    <td class="px-4 py-3 text-muted" th:text="${p.size} >= 0 ? ${p.size} + ' B' : '—'">—</td>
                    <td class="px-4 py-3 text-right">
                        <a th:href="@{/settings/oidc/rbac/{file}(file=${p.name})}"
                           class="inline-flex items-center gap-2 rounded-lg bg-background border border-border text-foreground px-3 py-1.5 text-sm font-semibold hover:bg-background/60">
                            Open
                            <svg class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7"/>
                            </svg>
                        </a>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>
    </section>

</th:block>

</body>
</html>
